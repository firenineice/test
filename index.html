<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js å¯äº¤äº’3Dæ¨¡å‹</title>
    <style>
        body { margin: 0; overflow: hidden; }
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            background: rgba(0,0,0,0.6);
            padding: 8px 15px;
            border-radius: 20px;
            font-family: Arial, Helvetica, sans-serif;
            pointer-events: none;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="info">âœ¨ é¼ æ ‡æ‹–æ‹½æ—‹è½¬ | æ»šè½®ç¼©æ”¾</div>

    <!-- 1. ä½¿ç”¨ Import Map ç»Ÿä¸€ç®¡ç† Three.js å’Œå…¶æ‰©å±•åº“çš„å¼•å…¥ -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.128.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.128.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        // 2. å¯¼å…¥æ‰€éœ€æ¨¡å—
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

        // --- åˆå§‹åŒ–åœºæ™¯ã€ç›¸æœºã€æ¸²æŸ“å™¨ (è¿™æ˜¯Three.jsåº”ç”¨çš„åŸºç¡€) ---
        const scene = new THREE.Scene();
        // è®¾ç½®èƒŒæ™¯è‰²ä¸ºæ·±ç°è‰²ï¼Œè®©ç™½è‰²æˆ–äº®è‰²æ¨¡å‹æ›´çªå‡º
        scene.background = new THREE.Color(0xcccccc);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(8, 4, 12); // å°†ç›¸æœºæ”¾åœ¨ä¸€ä¸ªåˆé€‚çš„åˆå§‹ä½ç½®
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true; // å¼€å¯é˜´å½±ï¼Œè®©æ•ˆæœæ›´çœŸå®ï¼ˆå¦‚æœæ¨¡å‹æ”¯æŒï¼‰
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        // --- æ·»åŠ åŸºç¡€å…‰ç…§ï¼Œå¦åˆ™æ¨¡å‹çœ‹èµ·æ¥æ˜¯é»‘çš„ ---
        // ç¯å¢ƒå…‰æä¾›åŸºç¡€ç…§æ˜
        const ambientLight = new THREE.AmbientLight(0x404060, 1.5);
        scene.add(ambientLight);

        // ä¸»å…‰æº - äº§ç”Ÿé˜´å½±å’Œç«‹ä½“æ„Ÿçš„å¹³è¡Œå…‰
        const dirLight = new THREE.DirectionalLight(0xffffff, 2);
        dirLight.position.set(2, 5, 3);
        dirLight.castShadow = true;
        dirLight.receiveShadow = true;
        scene.add(dirLight);

        // æ·»åŠ ä¸€ä¸ªè¾…åŠ©èƒŒæ™¯å…‰ï¼Œç…§äº®æ¨¡å‹çš„èƒŒé¢
        const backLight = new THREE.PointLight(0x446688, 1);
        backLight.position.set(-3, 1, -4);
        scene.add(backLight);

        // å¯é€‰ï¼šæ·»åŠ ä¸€ä¸ªè¾…åŠ©åœ°é¢ç½‘æ ¼ï¼Œå¸®åŠ©æ„Ÿå—ç©ºé—´å’Œæ¯”ä¾‹
        const gridHelper = new THREE.GridHelper(20, 20, 0xaaaaaa, 0x444444);
        scene.add(gridHelper);
        
        // å¯é€‰ï¼šæ·»åŠ åæ ‡è½´è¾…åŠ© (çº¢X, ç»¿Y, è“Z)
        // const axesHelper = new THREE.AxesHelper(5);
        // scene.add(axesHelper);

        // --- åˆå§‹åŒ–è½¨é“æ§åˆ¶å™¨ (è¿™æ˜¯å®ç°è‡ªç”±æ‹–åŠ¨æ—‹è½¬çš„å…³é”®) ---
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; // å¯ç”¨æƒ¯æ€§æ•ˆæœï¼Œè®©æ‹–åŠ¨æ›´å¹³æ»‘
        controls.dampingFactor = 0.05;
        controls.screenSpacePanning = true; // å…è®¸å¹³ç§»
        controls.maxPolarAngle = Math.PI / 2; // é™åˆ¶ä¸èƒ½è½¬åˆ°åœ°ä¸‹
        controls.target.set(0, 2, 0); // è®¾ç½®æ§åˆ¶å™¨çš„ç„¦ç‚¹ï¼Œè®©æ¨¡å‹å±…ä¸­

        // --- åŠ è½½ä½ çš„3Dæ¨¡å‹ ---
        const loader = new GLTFLoader();
        const modelUrl = './å¤å»ºç­‘.glb'; // è¯·æ›¿æ¢ä¸ºä½ çš„æ¨¡å‹è·¯å¾„ (æ”¯æŒ .glb, .gltf, .obj ç­‰)

        loader.load(
            modelUrl,
            (gltf) => {
    const model = gltf.scene;
    
    // å¯é€‰ï¼šè°ƒæ•´æ¨¡å‹çš„ç¼©æ”¾ã€ä½ç½®ä»¥é€‚åº”åœºæ™¯
    model.scale.set(1.5, 1.5, 1.5);
    model.position.set(0, 1.5, 0);
    
    // è®©æ¨¡å‹èƒ½å¤ŸæŠ•å°„å’Œæ¥æ”¶é˜´å½±...
    model.traverse((node) => {
        if (node.isMesh) {
            node.castShadow = true;
            node.receiveShadow = true;
        }
    });

    scene.add(model);
    console.log('âœ… æ¨¡å‹åŠ è½½æˆåŠŸ');
},
            (xhr) => {
                // åŠ è½½è¿›åº¦
                const percent = Math.floor((xhr.loaded / xhr.total) * 100);
                console.log(`ğŸ“¦ åŠ è½½è¿›åº¦: ${percent}%`);
                // ä½ å¯ä»¥åœ¨è¿™é‡Œæ›´æ–°ä¸€ä¸ªè¿›åº¦æ¡UI
            },
            (error) => {
                console.error('âŒ æ¨¡å‹åŠ è½½å¤±è´¥:', error);
            }
        );

        // --- åŠ¨ç”»å¾ªç¯ (ä½¿åœºæ™¯æŒç»­æ¸²æŸ“ï¼Œå¹¶æ›´æ–°æ§åˆ¶å™¨) ---
        function animate() {
            requestAnimationFrame(animate);

            // æ›´æ–°æ§åˆ¶å™¨ï¼ˆå¦‚æœå¯ç”¨äº† dampingï¼Œè¿™ä¸€æ­¥å¿…é¡»è¦æœ‰ï¼‰
            controls.update();

            // æ¸²æŸ“åœºæ™¯
            renderer.render(scene, camera);
        }
        animate();

        // --- å¤„ç†çª—å£å¤§å°å˜åŒ–ï¼Œè‡ªé€‚åº”ç”»å¸ƒ ---
        window.addEventListener('resize', onWindowResize, false);
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
    </script>
</body>
</html>